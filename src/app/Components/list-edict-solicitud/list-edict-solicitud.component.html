<div class="contenedor container">
  <h4>Listado de Solicitudes</h4>
  <div class="title">
    <div class="filtro-fechas">
      <label for="fechaInicio">Fecha Inicio:</label>
      <input type="date" id="fechaInicio" [(ngModel)]="fechaInicio">
      <label for="fechaFin">Fecha Fin:</label>
      <input type="date" id="fechaFin" [(ngModel)]="fechaFin">
      <input *ngIf="rolUsuario !== 'Colaborador'" type="text" id="documento" [(ngModel)]="documento" placeholder="Ingrese # Documento">
      <button type="button" class="btn btn-primary" (click)="filtrarSolicitudes()">Filtrar</button>
    </div>
    
    <div *ngIf="rolUsuario !== 'Colaborador'" class="estado-solicitudes-container">
      <label for="estado-select">Estado:</label>
      <select id="estado-select" [(ngModel)]="estadoSeleccionado" name="estado" class="form-control" required #terceroInput="ngModel">
        <option *ngFor="let estado of estadoDeSolicitud" [value]="estado._id">
          {{ estado.nombre }}
        </option>
      </select>
      <button (click)="guardarCambiosEstado()" type="button" class="btn btn-danger btn-sm ms-2">Guardar</button>
    </div>
    
  </div>

  <button type="button" class="btn btn-success" routerLink="/add">Agregar Solicitud</button>
  <table datatable [dtOptions]="dtOptions"  *ngIf="listSolicitudes.length > 0" class="table">
    <thead>
      <tr class="table-primary">
        <th scope="col">Solicitud #</th>
        <th scope="col">Fecha</th>
        <th scope="col">Proveedor</th>
        <th scope="col">Estado</th>
        <th scope="col">Detalle</th>
        <th scope="col">Valor</th>
        <th scope="col">Selec</th>
        <th scope="col">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let solicitud of listSolicitudes" class="table-active">
        <td>{{ solicitud.solicitudId }}</td>
        <td>{{ solicitud.fecha | date: 'dd-MM-yyyy' }}</td>
        <td>{{ solicitud.tercero?.nombreTercero }}</td>
        <td [style.backgroundColor]="getColorByEstado(solicitud.estado?.nombre)">
          {{ solicitud.estado?.nombre }}
        </td>
        <td>{{ solicitud.detalle }}</td>
        <td>{{ solicitud.valor | currency }}</td>
        <td>
          <div class="checkbox-container">
            <input *ngIf="rolUsuario !== 'Colaborador'&& solicitud.estado?.nombre !== 'finalizado'" type="checkbox" (change)="seleccionarSolicitud(solicitud?._id)">
          </div>
        </td>
        <td>
          <button [routerLink]="['/edit', solicitud._id]" type="button" class="btn btn-info btn-sm">Editar</button>
          <button (click)="verDetalle(solicitud)" type="button" class="btn btn-info btn-sm ms-2">Ver</button>
          <button *ngIf="rolUsuario !== 'Colaborador'" (click)="deleteSolicitud(solicitud._id)" type="button" class="btn btn-danger btn-sm ms-2">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <h5 *ngIf="listSolicitudes.length == 0">No hay Solicitudes para mostrar</h5>
</div>
